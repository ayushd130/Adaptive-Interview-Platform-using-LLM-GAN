{% extends "base.html" %}

{% block title %}Interview Results{% endblock %}


{% block content %}
{% if analytics %}
<div class="row mb-4">
    <div class="col-12">
        <h2>Interview Results</h2>
        <p>{{ interview.interview_type.title() }} Interview - {{ interview.created_at.strftime('%Y-%m-%d') }}</p>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ "%.0f" | format(analytics.overall_performance * 100) }}%</h3>
                <p>Overall Score</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ "%.0f" | format(analytics.technical_skills_score * 100) }}%</h3>
                <p>Technical Skills</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ "%.0f" | format(analytics.communication_skills_score * 100) }}%</h3>
                <p>Communication</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ "%.0f" | format(analytics.confidence_level * 100) }}%</h3>
                <p>Confidence</p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">Face Analysis</div>
            <div class="card-body">
                <small><strong>Eye Contact:</strong> {{ "%.0f" | format(analytics.eye_contact_percentage * 100) }}%</small><br>
                <small><strong>Response Time:</strong> {{ "%.1f" | format(analytics.average_response_time) }}s</small>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">AI Feedback</div>
            <div class="card-body">
                <h5>Strengths:</h5>
                <p>{{ analytics.strengths }}</p>
                <h5>Areas for Improvement:</h5>
                <p>{{ analytics.areas_for_improvement }}</p>
            </div>
        </div>
    </div>
</div>


{% else %}
<!-- Analytics History -->
<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-3">Analytics History</h2>
        <p class="text-muted">Track your interview performance over time</p>
    </div>
</div>

{% if analytics_list %}
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Overall Score</th>
                                <th>Technical Skills</th>
                                <th>Communication</th>
                                <th>Confidence</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for analytics in analytics_list %}
                            <tr>
                                <td>{{ analytics.interview.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    <span class="badge bg-{{ 'primary' if analytics.interview.interview_type == 'technical' else 'success' }}">
                                        {{ analytics.interview.interview_type.title() }}
                                    </span>
                                </td>
                                <td>
                                    <span class="fw-bold text-{{ 'success' if analytics.overall_performance >= 0.7 else 'warning' if analytics.overall_performance >= 0.5 else 'danger' }}">
                                        {{ "%.0f" | format(analytics.overall_performance * 100) }}%
                                    </span>
                                </td>
                                <td>{{ "%.0f" | format(analytics.technical_skills_score * 100) }}%</td>
                                <td>{{ "%.0f" | format(analytics.communication_skills_score * 100) }}%</td>
                                <td>{{ "%.0f" | format(analytics.confidence_level * 100) }}%</td>
                                <td>
                                    <a href="{{ url_for('view_analytics', interview_id=analytics.interview_id) }}" 
                                       class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-chart-line me-1"></i>View Details
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="text-center py-5">
            <i class="fas fa-chart-line display-1 text-muted mb-3"></i>
            <h5 class="text-muted">No analytics available yet</h5>
            <p class="text-muted">Complete some interviews to see your performance analytics.</p>
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                <i class="fas fa-play me-2"></i>Start Your First Interview
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}

{% block extra_scripts %}
{% if analytics %}
<script>
// Simple performance chart using Chart.js
const ctx = document.getElementById('performanceChart');
if (ctx) {
    new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Overall', 'Technical', 'Communication', 'Confidence'],
            datasets: [{
                label: 'Score (%)',
                data: [
                    {{ (analytics.overall_performance * 100) | round }},
                    {{ (analytics.technical_skills_score * 100) | round }},
                    {{ (analytics.communication_skills_score * 100) | round }},
                    {{ (analytics.confidence_level * 100) | round }}
                ],
                backgroundColor: ['#007bff', '#28a745', '#17a2b8', '#ffc107'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}
</script>
{% endif %}
{% endblock %}
